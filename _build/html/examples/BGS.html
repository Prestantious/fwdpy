<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Example: background selection &mdash; fwdpy 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="fwdpy 0.0.1 documentation" href="../index.html" />
    <link rel="next" title="Example of taking ‘views’ from simulated populations" href="views.html" />
    <link rel="prev" title="How many threads to use?" href="../docs/threads.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="views.html" title="Example of taking ‘views’ from simulated populations"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../docs/threads.html" title="How many threads to use?"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">fwdpy 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="example-background-selection">
<h1>Example: background selection<a class="headerlink" href="#example-background-selection" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-the-simulation">
<h2>Setting up the simulation<a class="headerlink" href="#setting-up-the-simulation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Neutral mutations will occur on the interval <span class="math">\([0,1)\)</span>.</li>
<li>Strongly-deleterious mutations will occur on the intervals
<span class="math">\([-1,0)\)</span> and <span class="math">\([1,2)\)</span>.</li>
<li>Recombination will be uniform throughout the region.</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Use Pyhon 3&#39;s print a a function.</span>
<span class="c">#This future-proofs the code in the notebook</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="c">#Import fwdpy.  Give it a shorter name</span>
<span class="kn">import</span> <span class="nn">fwdpy</span> <span class="kn">as</span> <span class="nn">fp</span>
<span class="c">##Other libs we need</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
<div class="section" id="establishing-regions-for-mutation-and-recombination">
<h3>Establishing &#8216;regions&#8217; for mutation and recombination<a class="headerlink" href="#establishing-regions-for-mutation-and-recombination" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Where neutral mutations occur:</span>
<span class="n">nregions</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Where selected mutations occur:</span>
<span class="n">sregions</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">ConstantS</span><span class="p">(</span><span class="n">beg</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">ConstantS</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Recombination:</span>
<span class="n">recregions</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="n">beg</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="population-size-and-simulation-length">
<h3>Population size and simulation length<a class="headerlink" href="#population-size-and-simulation-length" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Population size</span>
<span class="n">N</span><span class="o">=</span><span class="mi">1000</span>
<span class="c">#We&#39;ll evolve for 10N generations.</span>
<span class="c">#nlist is a list of population sizes over time.</span>
<span class="c">#len(nlist) is the length of the simulation</span>
<span class="c">#We use numpy arrays for speed and optimised RAM</span>
<span class="c">#use.  Note the dtype=np.uint32, which means 32-bit</span>
<span class="c">#unsigned integer. Failure to use this type will</span>
<span class="c">#cause a run-time error.</span>
<span class="n">nlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">N</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Initalize a random number generator with seed value of 101</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">GSLrng</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Simulate 4 replicate populations.  This uses C++11 threads behind the scenes:</span>
<span class="n">pops</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">evolve_regions</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span>       <span class="c">#The random number generator</span>
                         <span class="mi">4</span><span class="p">,</span>         <span class="c">#The number of pops to simulate = number of threads to use.</span>
                         <span class="n">N</span><span class="p">,</span>         <span class="c">#Initial population size for each of the 4 demes</span>
                         <span class="n">nlist</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span> <span class="c">#List of population sizes over time.</span>
                         <span class="mf">0.005</span><span class="p">,</span>     <span class="c">#Neutral mutation rate (per gamete, per generation)</span>
                         <span class="mf">0.01</span><span class="p">,</span>      <span class="c">#Deleterious mutation rate (per gamete, per generation)</span>
                         <span class="mf">0.005</span><span class="p">,</span>     <span class="c">#Recombination rate (per diploid, per generation)</span>
                         <span class="n">nregions</span><span class="p">,</span>  <span class="c">#Defined above</span>
                         <span class="n">sregions</span><span class="p">,</span>  <span class="c">#Defined above</span>
                         <span class="n">recregions</span><span class="p">)</span><span class="c">#Defined above</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Now, pops is a Python list with len(pops) = 4</span>
<span class="c">#Each element&#39;s type is fwdpy.singlepop</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pops</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pops</span><span class="p">)):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pops</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>4
&lt;type &#39;fwdpy.fwdpy.singlepop&#39;&gt;
&lt;type &#39;fwdpy.fwdpy.singlepop&#39;&gt;
&lt;type &#39;fwdpy.fwdpy.singlepop&#39;&gt;
&lt;type &#39;fwdpy.fwdpy.singlepop&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="taking-samples-from-simulated-populations">
<h2>Taking samples from simulated populations<a class="headerlink" href="#taking-samples-from-simulated-populations" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Use a list comprehension to get a random sample of size</span>
<span class="c">#n = 20 from each replicate</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pops</span><span class="p">]</span>

<span class="c">#Samples is now a list of tuples of two lists.</span>
<span class="c">#Each list contains tuples of mutation positions and genotypes.</span>
<span class="c">#The first list represents neutral variants.</span>
<span class="c">#The second list represents variants affecting fitness (&#39;selected&#39; variants)</span>
<span class="c">#We will manipulate/analyze these genotypes, etc.,</span>
<span class="c">#in a later example</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">&quot;A sample from a population is a &quot;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>A sample from a population is a  &lt;type &#39;tuple&#39;&gt;
A sample from a population is a  &lt;type &#39;tuple&#39;&gt;
A sample from a population is a  &lt;type &#39;tuple&#39;&gt;
A sample from a population is a  &lt;type &#39;tuple&#39;&gt;
4
</pre></div>
</div>
<div class="section" id="getting-additional-information-about-samples">
<h3>Getting additional information about samples<a class="headerlink" href="#getting-additional-information-about-samples" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Again, use list comprehension to get the &#39;details&#39; of each sample</span>
<span class="c">#Given that each object in samples is a tuple, and that the second</span>
<span class="c">#item in each tuple represents selected mutations, i[1] in the line</span>
<span class="c">#below means that we are getting the mutation information only for</span>
<span class="c">#selected variants</span>
<span class="n">details</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">get_sample_details</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span><span class="n">pops</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#details is now a list of pandas DataFrame objects</span>
<span class="c">#Each DataFrame has the following columns:</span>
<span class="c">#  a: mutation age (in generations)</span>
<span class="c">#  h: dominance of the mutation</span>
<span class="c">#  p: frequency of the mutation in the population</span>
<span class="c">#  s: selection coefficient of the mutation</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">details</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>    a  h      p     s
0  67  1  0.006 -0.05
     a  h       p     s
0   19  1  0.0025 -0.05
1    6  1  0.0055 -0.05
2   17  1  0.0120 -0.05
3  149  1  0.0235 -0.05
4   36  1  0.0070 -0.05
5   24  1  0.0080 -0.05
    a  h       p     s
0   3  1  0.0030 -0.05
1   1  1  0.0005 -0.05
2  19  1  0.0060 -0.05
    a  h       p     s
0  24  1  0.0145 -0.05
1   5  1  0.0010 -0.05
2   2  1  0.0020 -0.05
3  10  1  0.0105 -0.05
4   6  1  0.0020 -0.05
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>#The order of the rows in each DataFrame is the
#same as the order as the objects in &#39;samples&#39;:
for i in range(len(samples)):
    print(&quot;Number of sites in samples[&quot;,i,&quot;] = &quot;,
          len(samples[i][1]),&quot;. Number of rows in DataFrame &quot;,i,
          &quot; = &quot;,len(details[i].index),sep=&quot;&quot;)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Number of sites in samples[0] = 1. Number of rows in DataFrame 0 = 1
Number of sites in samples[1] = 6. Number of rows in DataFrame 1 = 6
Number of sites in samples[2] = 3. Number of rows in DataFrame 2 = 3
Number of sites in samples[3] = 5. Number of rows in DataFrame 3 = 5
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Pandas DataFrames are cool.</span>
<span class="c">#Let&#39;s add a column to each DataFrame</span>
<span class="c">#specifying the mutation position,</span>
<span class="c">#count of derived state,</span>
<span class="c">#and a &quot;replicate ID&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">details</span><span class="p">)):</span>
    <span class="c">##samples[i][1] again is the selected mutations in the sample taken</span>
    <span class="c">##from the i-th replicate</span>
    <span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;pos&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>               <span class="c">#Mutation position</span>
    <span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;count&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="c">#No. occurrences of derived state in sample</span>
    <span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>                    <span class="c">#Replicate id</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">##Merge into 1 big DataFrame:</span>
<span class="n">BigTable</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;This is the merged table:&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">BigTable</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>This is the merged table:
     a  h       p     s       pos  count  id
0   67  1  0.0060 -0.05  1.877543      1   0
0   19  1  0.0025 -0.05 -0.928520      1   1
1    6  1  0.0055 -0.05 -0.861297      1   1
2   17  1  0.0120 -0.05 -0.843893      1   1
3  149  1  0.0235 -0.05 -0.472551      1   1
4   36  1  0.0070 -0.05 -0.426389      1   1
5   24  1  0.0080 -0.05  1.162503      1   1
0    3  1  0.0030 -0.05 -0.309919      1   2
1    1  1  0.0005 -0.05  1.534583      1   2
2   19  1  0.0060 -0.05  1.575055      1   2
0   24  1  0.0145 -0.05 -0.996158      1   3
1    5  1  0.0010 -0.05 -0.317365      1   3
2    2  1  0.0020 -0.05 -0.124097      1   3
3   10  1  0.0105 -0.05  1.342523      1   3
4    6  1  0.0020 -0.05  1.515371      1   3
</pre></div>
</div>
</div>
</div>
<div class="section" id="summary-statistics-from-samples">
<h2>Summary statistics from samples<a class="headerlink" href="#summary-statistics-from-samples" title="Permalink to this headline">¶</a></h2>
<p>We will use the <a class="reference external" href="http://molpopgen.github.io/pylibseq/">pylibseq</a>
package to calculate summary statistics. pylibseq is a Python wrapper
around <a class="reference external" href="http://molpopgen.github.io/libsequence/">libsequence</a>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">libsequence.polytable</span> <span class="kn">as</span> <span class="nn">polyt</span>
<span class="kn">import</span> <span class="nn">libsequence.summstats</span> <span class="kn">as</span> <span class="nn">sstats</span>

<span class="c">#Convert neutral mutations into libsequence &quot;SimData&quot; objects,</span>
<span class="c">#which are intended to handle binary (0/1) data like</span>
<span class="c">#what comes out of these simulations</span>
<span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="n">polyt</span><span class="o">.</span><span class="n">simData</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]</span>

<span class="c">#Create &quot;factories&quot; for calculating the summary stats</span>
<span class="n">an</span> <span class="o">=</span> <span class="p">[</span><span class="n">sstats</span><span class="o">.</span><span class="n">polySIM</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span>

<span class="c">##Collect a bunch of summary stats into a pandas.DataFrame:</span>
<span class="n">NeutralMutStats</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span> <span class="p">{</span><span class="s">&#39;thetapi&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">thetapi</span><span class="p">(),</span><span class="s">&#39;npoly&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">numpoly</span><span class="p">(),</span><span class="s">&#39;thetaw&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">thetaw</span><span class="p">()}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">an</span> <span class="p">])</span>

<span class="n">NeutralMutStats</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>npoly</th>
      <th>thetapi</th>
      <th>thetaw</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>62</td>
      <td>18.405263</td>
      <td>17.475916</td>
    </tr>
    <tr>
      <th>1</th>
      <td>47</td>
      <td>12.763158</td>
      <td>13.247872</td>
    </tr>
    <tr>
      <th>2</th>
      <td>74</td>
      <td>19.310526</td>
      <td>20.858351</td>
    </tr>
    <tr>
      <th>3</th>
      <td>65</td>
      <td>13.205263</td>
      <td>18.321525</td>
    </tr>
  </tbody>
</table>
</div><div class="section" id="the-average-under-the-model">
<h3>The average <span class="math">\(\pi\)</span> under the model<a class="headerlink" href="#the-average-under-the-model" title="Permalink to this headline">¶</a></h3>
<p>Under the BGS model, the expectation of <span class="math">\(\pi\)</span> is
<span class="math">\(E[\pi]=\pi_0e^{-\frac{U}{2sh+r}},\)</span> <span class="math">\(U\)</span> is the mutation rate
to strongly-deleterious variants, <span class="math">\(\pi_0\)</span> is the value expected in
the absence of BGS (<em>i.e.</em> <span class="math">\(\pi_0 = \theta = 4N_e\mu\)</span>), <span class="math">\(s\)</span>
and <span class="math">\(h\)</span> are the selection and dominance coefficients, and
<span class="math">\(r\)</span> is the recombination rate.</p>
<p>Note that the definition of <span class="math">\(U\)</span> is <em>per diploid</em>, meaning twice
the per gamete rate. (See Hudson and Kaplan (1995) PMC1206891 for
details).</p>
<p>For our parameters, we have
<span class="math">\(E[\pi] = 20e^{-\frac{0.02}{0.1+0.005}},\)</span> which equals:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.02</span><span class="o">/</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="mf">0.005</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">16.5313087525</span>
</pre></div>
</div>
<p>Now, let&#8217;s get the average $pi$ from 500 simulated replicates.  We already have four replicates that we did above, so we&#8217;ll run another 124 sets of four populations.</p>
<p>We will use standard Python to grow our collection of summary statistics.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">pops</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">evolve_regions</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span>
                         <span class="mi">4</span><span class="p">,</span>
                         <span class="n">N</span><span class="p">,</span>
                         <span class="n">nlist</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span>
                         <span class="mf">0.005</span><span class="p">,</span>
                         <span class="mf">0.01</span><span class="p">,</span>
                         <span class="mf">0.005</span><span class="p">,</span>
                         <span class="n">nregions</span><span class="p">,</span>
                         <span class="n">sregions</span><span class="p">,</span>
                         <span class="n">recregions</span><span class="p">)</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pops</span><span class="p">]</span>
    <span class="n">simdatasNeut</span> <span class="o">=</span> <span class="p">[</span><span class="n">polyt</span><span class="o">.</span><span class="n">simData</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]</span>
    <span class="n">polySIMn</span> <span class="o">=</span> <span class="p">[</span><span class="n">sstats</span><span class="o">.</span><span class="n">polySIM</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">simdatasNeut</span><span class="p">]</span>
    <span class="c">##Append stats into our growing DataFrame:</span>
    <span class="n">NeutralMutStats</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">NeutralMutStats</span><span class="p">,</span>
                                   <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span> <span class="p">{</span><span class="s">&#39;thetapi&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">thetapi</span><span class="p">(),</span>
                                                       <span class="s">&#39;npoly&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">numpoly</span><span class="p">(),</span>
                                                       <span class="s">&#39;thetaw&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">thetaw</span><span class="p">()}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">polySIMn</span> <span class="p">])])</span>
</pre></div>
</div>
<div class="section" id="getting-the-mean-diversity">
<h4>Getting the mean diversity<a class="headerlink" href="#getting-the-mean-diversity" title="Permalink to this headline">¶</a></h4>
<p>We&#8217;ve collected everything into a big pandas DataFrame. We can easily
get the mean using the built-in groupby and mean functions.</p>
<p>For users happier in R, you could write this DataFrame to a text file
and process it using R&#8217;s
<a class="reference external" href="http://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a>
package, which is a really excellent tool for this sort of thing.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Get means for each column:</span>
<span class="n">NeutralMutStats</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>npoly      57.280000
thetapi    15.743958
thetaw     16.145491
dtype: float64
</pre></div>
</div>
<p>The &#8216;thetapi&#8217; record is our mean <span class="math">\(\pi\)</span> from all of the
simulations, and it is quite close to the theoretical value.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Example: background selection</a><ul>
<li><a class="reference internal" href="#setting-up-the-simulation">Setting up the simulation</a><ul>
<li><a class="reference internal" href="#establishing-regions-for-mutation-and-recombination">Establishing &#8216;regions&#8217; for mutation and recombination</a></li>
<li><a class="reference internal" href="#population-size-and-simulation-length">Population size and simulation length</a></li>
</ul>
</li>
<li><a class="reference internal" href="#taking-samples-from-simulated-populations">Taking samples from simulated populations</a><ul>
<li><a class="reference internal" href="#getting-additional-information-about-samples">Getting additional information about samples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary-statistics-from-samples">Summary statistics from samples</a><ul>
<li><a class="reference internal" href="#the-average-under-the-model">The average <span class="math">\(\pi\)</span> under the model</a><ul>
<li><a class="reference internal" href="#getting-the-mean-diversity">Getting the mean diversity</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../docs/threads.html"
                        title="previous chapter">How many threads to use?</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="views.html"
                        title="next chapter">Example of taking &#8216;views&#8217; from simulated populations</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/BGS.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="views.html" title="Example of taking ‘views’ from simulated populations"
             >next</a> |</li>
        <li class="right" >
          <a href="../docs/threads.html" title="How many threads to use?"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">fwdpy 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Kevin Thornton.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>