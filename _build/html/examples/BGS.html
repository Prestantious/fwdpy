<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Example: background selection &#8212; fwdpy 0.0.4pre1 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.4pre1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example of taking ‘views’ from simulated populations" href="views.html" />
    <link rel="prev" title="How many threads to use?" href="../docs/threads.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="views.html" title="Example of taking ‘views’ from simulated populations"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../docs/threads.html" title="How many threads to use?"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">fwdpy 0.0.4pre1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="example-background-selection">
<h1>Example: background selection<a class="headerlink" href="#example-background-selection" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-the-simulation">
<h2>Setting up the simulation<a class="headerlink" href="#setting-up-the-simulation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Neutral mutations will occur on the interval <span class="math">\([0,1)\)</span>.</li>
<li>Strongly-deleterious mutations will occur on the intervals
<span class="math">\([-1,0)\)</span> and <span class="math">\([1,2)\)</span>.</li>
<li>Recombination will be uniform throughout the region.</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Use Python 3&#39;s print a a function.</span>
<span class="c1">#This future-proofs the code in the notebook</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="c1">#Import fwdpy.  Give it a shorter name</span>
<span class="kn">import</span> <span class="nn">fwdpy</span> <span class="k">as</span> <span class="nn">fp</span>
<span class="c1">##Other libs we need</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
<div class="section" id="establishing-regions-for-mutation-and-recombination">
<h3>Establishing &#8216;regions&#8217; for mutation and recombination<a class="headerlink" href="#establishing-regions-for-mutation-and-recombination" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Where neutral mutations occur:</span>
<span class="n">nregions</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Where selected mutations occur:</span>
<span class="n">sregions</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">ConstantS</span><span class="p">(</span><span class="n">beg</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">ConstantS</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Recombination:</span>
<span class="n">recregions</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="n">beg</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="population-size-and-simulation-length">
<h3>Population size and simulation length<a class="headerlink" href="#population-size-and-simulation-length" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Population size</span>
<span class="n">N</span><span class="o">=</span><span class="mi">1000</span>
<span class="c1">#We&#39;ll evolve for 10N generations.</span>
<span class="c1">#nlist is a list of population sizes over time.</span>
<span class="c1">#len(nlist) is the length of the simulation</span>
<span class="c1">#We use numpy arrays for speed and optimised RAM</span>
<span class="c1">#use.  Note the dtype=np.uint32, which means 32-bit</span>
<span class="c1">#unsigned integer. Failure to use this type will</span>
<span class="c1">#cause a run-time error.</span>
<span class="n">nlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">N</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Initalize a random number generator with seed value of 101</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">GSLrng</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Simulate 40 replicate populations.  This uses C++11 threads behind the scenes:</span>
<span class="n">pops</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">evolve_regions</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span>       <span class="c1">#The random number generator</span>
                         <span class="mi">40</span><span class="p">,</span>         <span class="c1">#The number of pops to simulate = number of threads to use.</span>
                         <span class="n">N</span><span class="p">,</span>         <span class="c1">#Initial population size for each of the 40 demes</span>
                         <span class="n">nlist</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span> <span class="c1">#List of population sizes over time.</span>
                         <span class="mf">0.005</span><span class="p">,</span>     <span class="c1">#Neutral mutation rate (per gamete, per generation)</span>
                         <span class="mf">0.01</span><span class="p">,</span>      <span class="c1">#Deleterious mutation rate (per gamete, per generation)</span>
                         <span class="mf">0.005</span><span class="p">,</span>     <span class="c1">#Recombination rate (per diploid, per generation)</span>
                         <span class="n">nregions</span><span class="p">,</span>  <span class="c1">#Defined above</span>
                         <span class="n">sregions</span><span class="p">,</span>  <span class="c1">#Defined above</span>
                         <span class="n">recregions</span><span class="p">)</span><span class="c1">#Defined above</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Now, pops is a Python list with len(pops) = 40</span>
<span class="c1">#Each element&#39;s type is fwdpy.singlepop</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pops</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pops</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">40</span>
<span class="o">&lt;</span><span class="nb">type</span> <span class="s1">&#39;fwdpy.fwdpy.Spop&#39;</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="taking-samples-from-simulated-populations">
<h2>Taking samples from simulated populations<a class="headerlink" href="#taking-samples-from-simulated-populations" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Use a list comprehension to get a random sample of size</span>
<span class="c1">#n = 20 from each replicate</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pops</span><span class="p">]</span>

<span class="c1">#Samples is now a list of tuples of two lists.</span>
<span class="c1">#Each list contains tuples of mutation positions and genotypes.</span>
<span class="c1">#The first list represents neutral variants.</span>
<span class="c1">#The second list represents variants affecting fitness (&#39;selected&#39; variants)</span>
<span class="c1">#We will manipulate/analyze these genotypes, etc.,</span>
<span class="c1">#in a later example</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[:</span><span class="mi">4</span><span class="p">]:</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;A sample from a population is a &quot;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="n">sample</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">population</span> <span class="ow">is</span> <span class="n">a</span>  <span class="o">&lt;</span><span class="nb">type</span> <span class="s1">&#39;tuple&#39;</span><span class="o">&gt;</span>
<span class="n">A</span> <span class="n">sample</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">population</span> <span class="ow">is</span> <span class="n">a</span>  <span class="o">&lt;</span><span class="nb">type</span> <span class="s1">&#39;tuple&#39;</span><span class="o">&gt;</span>
<span class="n">A</span> <span class="n">sample</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">population</span> <span class="ow">is</span> <span class="n">a</span>  <span class="o">&lt;</span><span class="nb">type</span> <span class="s1">&#39;tuple&#39;</span><span class="o">&gt;</span>
<span class="n">A</span> <span class="n">sample</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">population</span> <span class="ow">is</span> <span class="n">a</span>  <span class="o">&lt;</span><span class="nb">type</span> <span class="s1">&#39;tuple&#39;</span><span class="o">&gt;</span>
<span class="mi">40</span>
</pre></div>
</div>
<div class="section" id="getting-additional-information-about-samples">
<h3>Getting additional information about samples<a class="headerlink" href="#getting-additional-information-about-samples" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Again, use list comprehension to get the &#39;details&#39; of each sample</span>
<span class="c1">#Given that each object in samples is a tuple, and that the second</span>
<span class="c1">#item in each tuple represents selected mutations, i[1] in the line</span>
<span class="c1">#below means that we are getting the mutation information only for</span>
<span class="c1">#selected variants</span>
<span class="n">details</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">get_sample_details</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span><span class="n">pops</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#details is now a list of pandas DataFrame objects</span>
<span class="c1">#Each DataFrame has the following columns:</span>
<span class="c1">#  a: mutation age (in generations)</span>
<span class="c1">#  h: dominance of the mutation</span>
<span class="c1">#  p: frequency of the mutation in the population</span>
<span class="c1">#  s: selection coefficient of the mutation</span>
<span class="c1">#  label: A label applied for mutations for each region.  Here, I use 0 for all regions</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">details</span><span class="p">[:</span><span class="mi">4</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>      <span class="n">a</span>    <span class="n">h</span>  <span class="n">label</span>      <span class="n">p</span>     <span class="n">s</span>
<span class="mi">0</span>  <span class="mf">26.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.004</span> <span class="o">-</span><span class="mf">0.05</span>
      <span class="n">a</span>    <span class="n">h</span>  <span class="n">label</span>       <span class="n">p</span>     <span class="n">s</span>
<span class="mi">0</span>  <span class="mf">24.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0090</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">1</span>  <span class="mf">61.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0090</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">2</span>  <span class="mf">43.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0030</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">3</span>   <span class="mf">9.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0005</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">4</span>  <span class="mf">54.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0040</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">5</span>   <span class="mf">4.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0035</span> <span class="o">-</span><span class="mf">0.05</span>
      <span class="n">a</span>    <span class="n">h</span>  <span class="n">label</span>       <span class="n">p</span>     <span class="n">s</span>
<span class="mi">0</span>  <span class="mf">16.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0035</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">1</span>  <span class="mf">25.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0015</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">2</span>  <span class="mf">17.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0020</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">3</span>   <span class="mf">2.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0010</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">4</span>  <span class="mf">60.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0045</span> <span class="o">-</span><span class="mf">0.05</span>
      <span class="n">a</span>    <span class="n">h</span>  <span class="n">label</span>       <span class="n">p</span>     <span class="n">s</span>
<span class="mi">0</span>  <span class="mf">10.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0045</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">1</span>  <span class="mf">47.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0300</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">2</span>  <span class="mf">32.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0035</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="mi">3</span>  <span class="mf">13.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0005</span> <span class="o">-</span><span class="mf">0.05</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#The order of the rows in each DataFrame is the</span>
<span class="c1">#same as the order as the objects in &#39;samples&#39;:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of sites in samples[&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;] = &quot;</span><span class="p">,</span>
          <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="s2">&quot;. Number of rows in DataFrame &quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span>
          <span class="s2">&quot; = &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">of</span> <span class="n">sites</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">DataFrame</span> <span class="mi">0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">sites</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">6.</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">DataFrame</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">sites</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">DataFrame</span> <span class="mi">2</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">sites</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">DataFrame</span> <span class="mi">3</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Pandas DataFrames are cool.</span>
<span class="c1">#Let&#39;s add a column to each DataFrame</span>
<span class="c1">#specifying the mutation position,</span>
<span class="c1">#count of derived state,</span>
<span class="c1">#and a &quot;replicate ID&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">details</span><span class="p">)):</span>
    <span class="c1">##samples[i][1] again is the selected mutations in the sample taken</span>
    <span class="c1">##from the i-th replicate</span>
    <span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>               <span class="c1">#Mutation position</span>
    <span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="c1">#No. occurrences of derived state in sample</span>
    <span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>                    <span class="c1">#Replicate id</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">##Merge into 1 big DataFrame:</span>
<span class="n">BigTable</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is the merged table:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">BigTable</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">merged</span> <span class="n">table</span><span class="p">:</span>
        <span class="n">a</span>    <span class="n">h</span>  <span class="n">label</span>       <span class="n">p</span>     <span class="n">s</span>       <span class="n">pos</span>  <span class="n">count</span>  <span class="nb">id</span>
<span class="mi">0</span>    <span class="mf">26.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0040</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.283749</span>      <span class="mi">1</span>   <span class="mi">0</span>
<span class="mi">0</span>    <span class="mf">24.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0090</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.320125</span>      <span class="mi">1</span>   <span class="mi">1</span>
<span class="mi">1</span>    <span class="mf">61.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0090</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.119514</span>      <span class="mi">1</span>   <span class="mi">1</span>
<span class="mi">2</span>    <span class="mf">43.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0030</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.102664</span>      <span class="mi">1</span>   <span class="mi">1</span>
<span class="mi">3</span>     <span class="mf">9.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0005</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.042025</span>      <span class="mi">1</span>   <span class="mi">1</span>
<span class="mi">4</span>    <span class="mf">54.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0040</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.443235</span>      <span class="mi">1</span>   <span class="mi">1</span>
<span class="mi">5</span>     <span class="mf">4.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0035</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.804796</span>      <span class="mi">1</span>   <span class="mi">1</span>
<span class="mi">0</span>    <span class="mf">16.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0035</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.632548</span>      <span class="mi">1</span>   <span class="mi">2</span>
<span class="mi">1</span>    <span class="mf">25.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0015</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.460367</span>      <span class="mi">1</span>   <span class="mi">2</span>
<span class="mi">2</span>    <span class="mf">17.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0020</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.119099</span>      <span class="mi">1</span>   <span class="mi">2</span>
<span class="mi">3</span>     <span class="mf">2.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0010</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.055915</span>      <span class="mi">1</span>   <span class="mi">2</span>
<span class="mi">4</span>    <span class="mf">60.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0045</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.587909</span>      <span class="mi">1</span>   <span class="mi">2</span>
<span class="mi">0</span>    <span class="mf">10.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0045</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.480663</span>      <span class="mi">1</span>   <span class="mi">3</span>
<span class="mi">1</span>    <span class="mf">47.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0300</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.354161</span>      <span class="mi">2</span>   <span class="mi">3</span>
<span class="mi">2</span>    <span class="mf">32.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0035</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.351797</span>      <span class="mi">1</span>   <span class="mi">3</span>
<span class="mi">3</span>    <span class="mf">13.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0005</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.381058</span>      <span class="mi">1</span>   <span class="mi">3</span>
<span class="mi">0</span>     <span class="mf">8.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0010</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.897565</span>      <span class="mi">1</span>   <span class="mi">4</span>
<span class="mi">1</span>    <span class="mf">92.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0125</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.751551</span>      <span class="mi">1</span>   <span class="mi">4</span>
<span class="mi">2</span>     <span class="mf">3.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0010</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.123021</span>      <span class="mi">1</span>   <span class="mi">4</span>
<span class="mi">3</span>     <span class="mf">1.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0005</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.088541</span>      <span class="mi">1</span>   <span class="mi">4</span>
<span class="mi">4</span>    <span class="mf">19.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0065</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.242531</span>      <span class="mi">1</span>   <span class="mi">4</span>
<span class="mi">5</span>     <span class="mf">3.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0010</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.813220</span>      <span class="mi">1</span>   <span class="mi">4</span>
<span class="mi">0</span>    <span class="mf">13.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0025</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.438263</span>      <span class="mi">1</span>   <span class="mi">5</span>
<span class="mi">1</span>   <span class="mf">136.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0130</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.243305</span>      <span class="mi">1</span>   <span class="mi">5</span>
<span class="mi">2</span>    <span class="mf">62.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0035</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.196773</span>      <span class="mi">1</span>   <span class="mi">5</span>
<span class="mi">3</span>    <span class="mf">10.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0015</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.483931</span>      <span class="mi">1</span>   <span class="mi">5</span>
<span class="mi">4</span>    <span class="mf">23.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0075</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.723836</span>      <span class="mi">1</span>   <span class="mi">5</span>
<span class="mi">0</span>    <span class="mf">17.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0025</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.818220</span>      <span class="mi">1</span>   <span class="mi">6</span>
<span class="mi">1</span>    <span class="mf">19.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0120</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.323753</span>      <span class="mi">1</span>   <span class="mi">6</span>
<span class="mi">2</span>     <span class="mf">7.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0050</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.047837</span>      <span class="mi">1</span>   <span class="mi">6</span>
<span class="o">..</span>    <span class="o">...</span>  <span class="o">...</span>    <span class="o">...</span>     <span class="o">...</span>   <span class="o">...</span>       <span class="o">...</span>    <span class="o">...</span>  <span class="o">..</span>
<span class="mi">0</span>    <span class="mf">41.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0060</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.923395</span>      <span class="mi">1</span>  <span class="mi">33</span>
<span class="mi">1</span>    <span class="mf">20.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0080</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.880657</span>      <span class="mi">1</span>  <span class="mi">33</span>
<span class="mi">2</span>    <span class="mf">25.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0040</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.501588</span>      <span class="mi">1</span>  <span class="mi">33</span>
<span class="mi">3</span>    <span class="mf">24.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0095</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.434086</span>      <span class="mi">1</span>  <span class="mi">33</span>
<span class="mi">4</span>    <span class="mf">10.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0005</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.897750</span>      <span class="mi">1</span>  <span class="mi">33</span>
<span class="mi">0</span>     <span class="mf">2.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0010</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.521129</span>      <span class="mi">1</span>  <span class="mi">34</span>
<span class="mi">1</span>     <span class="mf">7.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0030</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.083328</span>      <span class="mi">1</span>  <span class="mi">34</span>
<span class="mi">2</span>    <span class="mf">42.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0075</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.777795</span>      <span class="mi">1</span>  <span class="mi">34</span>
<span class="mi">0</span>    <span class="mf">22.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0035</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.703952</span>      <span class="mi">1</span>  <span class="mi">35</span>
<span class="mi">1</span>    <span class="mf">41.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0125</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.385990</span>      <span class="mi">1</span>  <span class="mi">35</span>
<span class="mi">2</span>    <span class="mf">16.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0065</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.091824</span>      <span class="mi">1</span>  <span class="mi">35</span>
<span class="mi">3</span>    <span class="mf">15.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0020</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.257222</span>      <span class="mi">1</span>  <span class="mi">35</span>
<span class="mi">4</span>    <span class="mf">18.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0065</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.772582</span>      <span class="mi">1</span>  <span class="mi">35</span>
<span class="mi">0</span>    <span class="mf">12.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0020</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.595274</span>      <span class="mi">1</span>  <span class="mi">36</span>
<span class="mi">1</span>     <span class="mf">8.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0005</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.499114</span>      <span class="mi">1</span>  <span class="mi">36</span>
<span class="mi">2</span>    <span class="mf">12.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0070</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.416441</span>      <span class="mi">1</span>  <span class="mi">36</span>
<span class="mi">3</span>    <span class="mf">18.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0020</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.320007</span>      <span class="mi">1</span>  <span class="mi">36</span>
<span class="mi">4</span>    <span class="mf">25.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0020</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.178538</span>      <span class="mi">1</span>  <span class="mi">36</span>
<span class="mi">5</span>    <span class="mf">24.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0075</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.530433</span>      <span class="mi">1</span>  <span class="mi">36</span>
<span class="mi">0</span>     <span class="mf">9.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0110</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.941568</span>      <span class="mi">1</span>  <span class="mi">37</span>
<span class="mi">1</span>    <span class="mf">15.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0040</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.498442</span>      <span class="mi">1</span>  <span class="mi">37</span>
<span class="mi">0</span>     <span class="mf">4.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0035</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.221834</span>      <span class="mi">1</span>  <span class="mi">38</span>
<span class="mi">1</span>     <span class="mf">8.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0060</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.537788</span>      <span class="mi">1</span>  <span class="mi">38</span>
<span class="mi">2</span>     <span class="mf">2.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0010</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.738061</span>      <span class="mi">1</span>  <span class="mi">38</span>
<span class="mi">3</span>    <span class="mf">18.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0165</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.994364</span>      <span class="mi">1</span>  <span class="mi">38</span>
<span class="mi">0</span>    <span class="mf">22.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0030</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.983060</span>      <span class="mi">1</span>  <span class="mi">39</span>
<span class="mi">1</span>    <span class="mf">19.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0035</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.475971</span>      <span class="mi">1</span>  <span class="mi">39</span>
<span class="mi">2</span>     <span class="mf">7.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0020</span> <span class="o">-</span><span class="mf">0.05</span> <span class="o">-</span><span class="mf">0.105493</span>      <span class="mi">1</span>  <span class="mi">39</span>
<span class="mi">3</span>    <span class="mf">14.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0095</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.197116</span>      <span class="mi">2</span>  <span class="mi">39</span>
<span class="mi">4</span>     <span class="mf">2.0</span>  <span class="mf">1.0</span>      <span class="mi">0</span>  <span class="mf">0.0015</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="mf">1.257867</span>      <span class="mi">1</span>  <span class="mi">39</span>

<span class="p">[</span><span class="mi">143</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">8</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="summary-statistics-from-samples">
<h2>Summary statistics from samples<a class="headerlink" href="#summary-statistics-from-samples" title="Permalink to this headline">¶</a></h2>
<p>We will use the <a class="reference external" href="http://molpopgen.github.io/pylibseq/">pylibseq</a>
package to calculate summary statistics. pylibseq is a Python wrapper
around <a class="reference external" href="http://molpopgen.github.io/libsequence/">libsequence</a>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">libsequence.polytable</span> <span class="k">as</span> <span class="nn">polyt</span>
<span class="kn">import</span> <span class="nn">libsequence.summstats</span> <span class="k">as</span> <span class="nn">sstats</span>

<span class="c1">#Convert neutral mutations into libsequence &quot;SimData&quot; objects,</span>
<span class="c1">#which are intended to handle binary (0/1) data like</span>
<span class="c1">#what comes out of these simulations</span>
<span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="n">polyt</span><span class="o">.</span><span class="n">simData</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]</span>

<span class="c1">#Create &quot;factories&quot; for calculating the summary stats</span>
<span class="n">an</span> <span class="o">=</span> <span class="p">[</span><span class="n">sstats</span><span class="o">.</span><span class="n">polySIM</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span>

<span class="c1">##Collect a bunch of summary stats into a pandas.DataFrame:</span>
<span class="n">NeutralMutStats</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span> <span class="p">{</span><span class="s1">&#39;thetapi&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">thetapi</span><span class="p">(),</span><span class="s1">&#39;npoly&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">numpoly</span><span class="p">(),</span><span class="s1">&#39;thetaw&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">thetaw</span><span class="p">()}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">an</span> <span class="p">])</span>

<span class="n">NeutralMutStats</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>npoly</th>
      <th>thetapi</th>
      <th>thetaw</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>48</td>
      <td>12.636842</td>
      <td>13.529741</td>
    </tr>
    <tr>
      <th>1</th>
      <td>49</td>
      <td>12.563158</td>
      <td>13.811611</td>
    </tr>
    <tr>
      <th>2</th>
      <td>97</td>
      <td>35.968421</td>
      <td>27.341352</td>
    </tr>
    <tr>
      <th>3</th>
      <td>50</td>
      <td>12.921053</td>
      <td>14.093481</td>
    </tr>
    <tr>
      <th>4</th>
      <td>68</td>
      <td>17.015789</td>
      <td>19.167134</td>
    </tr>
    <tr>
      <th>5</th>
      <td>32</td>
      <td>8.584211</td>
      <td>9.019828</td>
    </tr>
    <tr>
      <th>6</th>
      <td>65</td>
      <td>18.905263</td>
      <td>18.321525</td>
    </tr>
    <tr>
      <th>7</th>
      <td>63</td>
      <td>20.036842</td>
      <td>17.757786</td>
    </tr>
    <tr>
      <th>8</th>
      <td>90</td>
      <td>28.968421</td>
      <td>25.368265</td>
    </tr>
    <tr>
      <th>9</th>
      <td>45</td>
      <td>12.452632</td>
      <td>12.684133</td>
    </tr>
    <tr>
      <th>10</th>
      <td>47</td>
      <td>12.242105</td>
      <td>13.247872</td>
    </tr>
    <tr>
      <th>11</th>
      <td>71</td>
      <td>20.752632</td>
      <td>20.012742</td>
    </tr>
    <tr>
      <th>12</th>
      <td>69</td>
      <td>19.900000</td>
      <td>19.449003</td>
    </tr>
    <tr>
      <th>13</th>
      <td>59</td>
      <td>10.900000</td>
      <td>16.630307</td>
    </tr>
    <tr>
      <th>14</th>
      <td>52</td>
      <td>14.494737</td>
      <td>14.657220</td>
    </tr>
    <tr>
      <th>15</th>
      <td>51</td>
      <td>16.563158</td>
      <td>14.375350</td>
    </tr>
    <tr>
      <th>16</th>
      <td>58</td>
      <td>14.500000</td>
      <td>16.348437</td>
    </tr>
    <tr>
      <th>17</th>
      <td>83</td>
      <td>29.478947</td>
      <td>23.395178</td>
    </tr>
    <tr>
      <th>18</th>
      <td>70</td>
      <td>25.689474</td>
      <td>19.730873</td>
    </tr>
    <tr>
      <th>19</th>
      <td>49</td>
      <td>15.473684</td>
      <td>13.811611</td>
    </tr>
    <tr>
      <th>20</th>
      <td>76</td>
      <td>23.847368</td>
      <td>21.422090</td>
    </tr>
    <tr>
      <th>21</th>
      <td>53</td>
      <td>7.784211</td>
      <td>14.939089</td>
    </tr>
    <tr>
      <th>22</th>
      <td>46</td>
      <td>14.315789</td>
      <td>12.966002</td>
    </tr>
    <tr>
      <th>23</th>
      <td>83</td>
      <td>27.100000</td>
      <td>23.395178</td>
    </tr>
    <tr>
      <th>24</th>
      <td>59</td>
      <td>17.157895</td>
      <td>16.630307</td>
    </tr>
    <tr>
      <th>25</th>
      <td>51</td>
      <td>14.778947</td>
      <td>14.375350</td>
    </tr>
    <tr>
      <th>26</th>
      <td>85</td>
      <td>20.984211</td>
      <td>23.958917</td>
    </tr>
    <tr>
      <th>27</th>
      <td>48</td>
      <td>12.915789</td>
      <td>13.529741</td>
    </tr>
    <tr>
      <th>28</th>
      <td>43</td>
      <td>9.763158</td>
      <td>12.120393</td>
    </tr>
    <tr>
      <th>29</th>
      <td>50</td>
      <td>12.063158</td>
      <td>14.093481</td>
    </tr>
    <tr>
      <th>30</th>
      <td>53</td>
      <td>8.421053</td>
      <td>14.939089</td>
    </tr>
    <tr>
      <th>31</th>
      <td>86</td>
      <td>26.073684</td>
      <td>24.240787</td>
    </tr>
    <tr>
      <th>32</th>
      <td>38</td>
      <td>10.889474</td>
      <td>10.711045</td>
    </tr>
    <tr>
      <th>33</th>
      <td>53</td>
      <td>13.236842</td>
      <td>14.939089</td>
    </tr>
    <tr>
      <th>34</th>
      <td>57</td>
      <td>9.842105</td>
      <td>16.066568</td>
    </tr>
    <tr>
      <th>35</th>
      <td>51</td>
      <td>11.831579</td>
      <td>14.375350</td>
    </tr>
    <tr>
      <th>36</th>
      <td>91</td>
      <td>29.989474</td>
      <td>25.650135</td>
    </tr>
    <tr>
      <th>37</th>
      <td>68</td>
      <td>18.752632</td>
      <td>19.167134</td>
    </tr>
    <tr>
      <th>38</th>
      <td>79</td>
      <td>23.105263</td>
      <td>22.267699</td>
    </tr>
    <tr>
      <th>39</th>
      <td>92</td>
      <td>27.031579</td>
      <td>25.932004</td>
    </tr>
  </tbody>
</table>
</div><div class="section" id="the-average-under-the-model">
<h3>The average <span class="math">\(\pi\)</span> under the model<a class="headerlink" href="#the-average-under-the-model" title="Permalink to this headline">¶</a></h3>
<p>Under the BGS model, the expectation of <span class="math">\(\pi\)</span> is
<span class="math">\(E[\pi]=\pi_0e^{-\frac{U}{2sh+r}},\)</span> <span class="math">\(U\)</span> is the mutation rate
to strongly-deleterious variants, <span class="math">\(\pi_0\)</span> is the value expected in
the absence of BGS (<em>i.e.</em> <span class="math">\(\pi_0 = \theta = 4N_e\mu\)</span>), <span class="math">\(s\)</span>
and <span class="math">\(h\)</span> are the selection and dominance coefficients, and
<span class="math">\(r\)</span> is the recombination rate.</p>
<p>Note that the definition of <span class="math">\(U\)</span> is <em>per diploid</em>, meaning twice
the per gamete rate. (See Hudson and Kaplan (1995) PMC1206891 for
details).</p>
<p>For our parameters, we have
<span class="math">\(E[\pi] = 20e^{-\frac{0.02}{0.1+0.005}},\)</span> which equals:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.02</span><span class="o">/</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="mf">0.005</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mf">16.5313087525</span>
</pre></div>
</div>
<p>Now, let&#8217;s get the average $pi$ from 1000 simulated replicates.  We already have 40 replicates that we did above, so we&#8217;ll run another 24 sets of four populations.</p>
<p>We will use standard Python to grow our collection of summary statistics.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">pops</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">evolve_regions</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span>
                         <span class="mi">40</span><span class="p">,</span>
                         <span class="n">N</span><span class="p">,</span>
                         <span class="n">nlist</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span>
                         <span class="mf">0.005</span><span class="p">,</span>
                         <span class="mf">0.01</span><span class="p">,</span>
                         <span class="mf">0.005</span><span class="p">,</span>
                         <span class="n">nregions</span><span class="p">,</span>
                         <span class="n">sregions</span><span class="p">,</span>
                         <span class="n">recregions</span><span class="p">)</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pops</span><span class="p">]</span>
    <span class="n">simdatasNeut</span> <span class="o">=</span> <span class="p">[</span><span class="n">polyt</span><span class="o">.</span><span class="n">simData</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]</span>
    <span class="n">polySIMn</span> <span class="o">=</span> <span class="p">[</span><span class="n">sstats</span><span class="o">.</span><span class="n">polySIM</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">simdatasNeut</span><span class="p">]</span>
    <span class="c1">##Append stats into our growing DataFrame:</span>
    <span class="n">NeutralMutStats</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">NeutralMutStats</span><span class="p">,</span>
                                   <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span> <span class="p">{</span><span class="s1">&#39;thetapi&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">thetapi</span><span class="p">(),</span>
                                                       <span class="s1">&#39;npoly&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">numpoly</span><span class="p">(),</span>
                                                       <span class="s1">&#39;thetaw&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">.</span><span class="n">thetaw</span><span class="p">()}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">polySIMn</span> <span class="p">])])</span>
</pre></div>
</div>
<div class="section" id="getting-the-mean-diversity">
<h4>Getting the mean diversity<a class="headerlink" href="#getting-the-mean-diversity" title="Permalink to this headline">¶</a></h4>
<p>We&#8217;ve collected everything into a big pandas DataFrame. We can easily
get the mean using the built-in groupby and mean functions.</p>
<p>For users happier in R, you could write this DataFrame to a text file
and process it using R&#8217;s
<a class="reference external" href="http://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a>
package, which is a really excellent tool for this sort of thing.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Get means for each column:</span>
<span class="n">NeutralMutStats</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">npoly</span>      <span class="mf">58.571000</span>
<span class="n">thetapi</span>    <span class="mf">16.319800</span>
<span class="n">thetaw</span>     <span class="mf">16.509385</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>The &#8216;thetapi&#8217; record is our mean <span class="math">\(\pi\)</span> from all of the
simulations, and it is quite close to the theoretical value.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Example: background selection</a><ul>
<li><a class="reference internal" href="#setting-up-the-simulation">Setting up the simulation</a><ul>
<li><a class="reference internal" href="#establishing-regions-for-mutation-and-recombination">Establishing &#8216;regions&#8217; for mutation and recombination</a></li>
<li><a class="reference internal" href="#population-size-and-simulation-length">Population size and simulation length</a></li>
</ul>
</li>
<li><a class="reference internal" href="#taking-samples-from-simulated-populations">Taking samples from simulated populations</a><ul>
<li><a class="reference internal" href="#getting-additional-information-about-samples">Getting additional information about samples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary-statistics-from-samples">Summary statistics from samples</a><ul>
<li><a class="reference internal" href="#the-average-under-the-model">The average <span class="math">\(\pi\)</span> under the model</a><ul>
<li><a class="reference internal" href="#getting-the-mean-diversity">Getting the mean diversity</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../docs/threads.html"
                        title="previous chapter">How many threads to use?</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="views.html"
                        title="next chapter">Example of taking &#8216;views&#8217; from simulated populations</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/BGS.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="views.html" title="Example of taking ‘views’ from simulated populations"
             >next</a> |</li>
        <li class="right" >
          <a href="../docs/threads.html" title="How many threads to use?"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">fwdpy 0.0.4pre1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Kevin Thornton.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>