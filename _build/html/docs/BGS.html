<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Example: background selection &mdash; fwdpy 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="fwdpy 0.0.1 documentation" href="../index.html" />
    <link rel="next" title="Example: Sliding windows" href="windows.html" />
    <link rel="prev" title="Example: Modeling regional variation in mutation and recombination" href="regions.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="windows.html" title="Example: Sliding windows"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="regions.html" title="Example: Modeling regional variation in mutation and recombination"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">fwdpy 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="example-background-selection">
<h1>Example: background selection<a class="headerlink" href="#example-background-selection" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-the-simulation">
<h2>Setting up the simulation<a class="headerlink" href="#setting-up-the-simulation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Neutral mutations will occur on the interval <span class="math">\([0,1)\)</span>.</li>
<li>Strongly-deleterious mutations will occur on the intervals
<span class="math">\([-1,0)\)</span> and <span class="math">\([1,2)\)</span>.</li>
<li>Recombination will be uniform throughout the region.</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre>#The next two lines let plots show up
#in the notbook:
%matplotlib inline
%pylab inline
#Use Pyhon 3&#39;s print a a function.
#This future-proofs the code in the notebook
from __future__ import print_function
#Import fwdpy.  Give it a shorter name
import fwdpy as fp
#Import the module for summary statistics. Give it a shorter name
import fwdpy.libseq as libseq
##Other libs we need
import numpy as np
import pandas
import math
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Populating the interactive namespace from numpy and matplotlib
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#We&#39;re going to do some plots at the end.</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="section" id="establishing-regions-for-mutation-and-recombination">
<h3>Establishing &#8216;regions&#8217; for mutation and recombination<a class="headerlink" href="#establishing-regions-for-mutation-and-recombination" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Where neutral mutations occur:</span>
<span class="n">nregions</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Where selected mutations occur:</span>
<span class="n">sregions</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">ConstantS</span><span class="p">(</span><span class="n">beg</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">ConstantS</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Recombination:</span>
<span class="n">recregions</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="n">beg</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="population-size-and-simulation-length">
<h3>Population size and simulation length<a class="headerlink" href="#population-size-and-simulation-length" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Population size</span>
<span class="n">N</span><span class="o">=</span><span class="mi">1000</span>
<span class="c">#We&#39;ll evolve for 10N generations.</span>
<span class="c">#nlist is a list of population sizes over time.</span>
<span class="c">#len(nlist) is the length of the simulation</span>
<span class="c">#We use numpy arrays for speed and optimised RAM</span>
<span class="c">#use.  Note the dtype=np.uint32, which means 32-bit</span>
<span class="c">#unsigned integer. Failure to use this type will</span>
<span class="c">#cause a run-time error.</span>
<span class="n">nlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">N</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Initalize a random number generator with seed value of 101</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">GSLrng</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Simulate 4 replicate populations.  This uses C++11 threads behind the scenes:</span>
<span class="n">pops</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">evolve_regions</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span>       <span class="c">#The random number generator</span>
                         <span class="mi">4</span><span class="p">,</span>         <span class="c">#The number of pops to simulate = number of threads to use.</span>
                         <span class="n">N</span><span class="p">,</span>         <span class="c">#Initial population size for each of the 4 demes</span>
                         <span class="n">nlist</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span> <span class="c">#List of population sizes over time.</span>
                         <span class="mf">0.005</span><span class="p">,</span>     <span class="c">#Neutral mutation rate (per gamete, per generation)</span>
                         <span class="mf">0.01</span><span class="p">,</span>      <span class="c">#Deleterious mutation rate (per gamete, per generation)</span>
                         <span class="mf">0.005</span><span class="p">,</span>     <span class="c">#Recombination rate (per diploid, per generation)</span>
                         <span class="n">nregions</span><span class="p">,</span>  <span class="c">#Defined above</span>
                         <span class="n">sregions</span><span class="p">,</span>  <span class="c">#Defined above</span>
                         <span class="n">recregions</span><span class="p">)</span><span class="c">#Defined above</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Now, pops is a Python list with len(pops) = 4</span>
<span class="c">#Each element&#39;s type is fwdpy.singlepop</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pops</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pops</span><span class="p">)):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pops</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>4
&lt;type &#39;fwdpy.fwdpy.singlepop&#39;&gt;
&lt;type &#39;fwdpy.fwdpy.singlepop&#39;&gt;
&lt;type &#39;fwdpy.fwdpy.singlepop&#39;&gt;
&lt;type &#39;fwdpy.fwdpy.singlepop&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="taking-samples-from-simulated-populations">
<h2>Taking samples from simulated populations<a class="headerlink" href="#taking-samples-from-simulated-populations" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Use a list comprehension to get a random sample of size</span>
<span class="c">#n = 20 from each replicate</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pops</span><span class="p">]</span>

<span class="c">#Samples is now a list of tuples of two lists.</span>
<span class="c">#Each list contains tuples of mutation positions and genotypes.</span>
<span class="c">#The first list represents neutral variants.</span>
<span class="c">#The second list represents variants affecting fitness (&#39;selected&#39; variants)</span>
<span class="c">#We will manipulate/analyze these genotypes, etc.,</span>
<span class="c">#in a later example</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">&quot;A sample from a population is a &quot;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>A sample from a population is a  &lt;type &#39;tuple&#39;&gt;
A sample from a population is a  &lt;type &#39;tuple&#39;&gt;
A sample from a population is a  &lt;type &#39;tuple&#39;&gt;
A sample from a population is a  &lt;type &#39;tuple&#39;&gt;
4
</pre></div>
</div>
<div class="section" id="getting-additional-information-about-samples">
<h3>Getting additional information about samples<a class="headerlink" href="#getting-additional-information-about-samples" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Again, use list comprehension to get the &#39;details&#39; of each sample</span>
<span class="c">#Given that each object in samples is a tuple, and that the second</span>
<span class="c">#item in each tuple represents selected mutations, i[1] in the line</span>
<span class="c">#below means that we are getting the mutation information only for</span>
<span class="c">#selected variants</span>
<span class="n">details</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">get_sample_details</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span><span class="n">pops</span><span class="p">)]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#details is now a list of pandas DataFrame objects</span>
<span class="c">#Each DataFrame has the following columns:</span>
<span class="c">#  a: mutation age (in generations)</span>
<span class="c">#  h: dominance of the mutation</span>
<span class="c">#  p: frequency of the mutation in the population</span>
<span class="c">#  s: selection coefficient of the mutation</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">details</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>    a  h       p     s
0  35  1  0.0075 -0.05
1   8  1  0.0040 -0.05
2  18  1  0.0030 -0.05
    a  h       p     s
0  19  1  0.0100 -0.05
1  13  1  0.0025 -0.05
    a  h       p     s
0  10  1  0.0090 -0.05
1  29  1  0.0060 -0.05
2  15  1  0.0035 -0.05
    a  h       p     s
0   1  1  0.0005 -0.05
1  20  1  0.0065 -0.05
2  33  1  0.0080 -0.05
3   1  1  0.0005 -0.05
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>#The order of the rows in each DataFrame is the
#same as the order as the objects in &#39;samples&#39;:
for i in range(len(samples)):
    print(&quot;Number of sites in samples[&quot;,i,&quot;] = &quot;,
          len(samples[i][1]),&quot;. Number of rows in DataFrame &quot;,i,
          &quot; = &quot;,len(details[i].index),sep=&quot;&quot;)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Number of sites in samples[0] = 3. Number of rows in DataFrame 0 = 3
Number of sites in samples[1] = 2. Number of rows in DataFrame 1 = 2
Number of sites in samples[2] = 3. Number of rows in DataFrame 2 = 3
Number of sites in samples[3] = 4. Number of rows in DataFrame 3 = 4
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Pandas DataFrames are cool.</span>
<span class="c">#Let&#39;s add a column to each DataFrame</span>
<span class="c">#specifying the mutation position,</span>
<span class="c">#count of derived state,</span>
<span class="c">#and a &quot;replicate ID&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">details</span><span class="p">)):</span>
    <span class="c">##samples[i][1] again is the selected mutations in the sample taken</span>
    <span class="c">##from the i-th replicate</span>
    <span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;pos&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>               <span class="c">#Mutation position</span>
    <span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;count&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="c">#No. occurrences of derived state in sample</span>
    <span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>                    <span class="c">#Replicate id</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">##Merge into 1 big DataFrame:</span>
<span class="n">BigTable</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;This is the merged table:&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">BigTable</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>This is the merged table:
    a  h       p     s       pos  count  id
0  35  1  0.0075 -0.05  1.191983      1   0
1   8  1  0.0040 -0.05  1.629000      1   0
2  18  1  0.0030 -0.05  1.721135      1   0
0  19  1  0.0100 -0.05  1.232333      1   1
1  13  1  0.0025 -0.05  1.710726      1   1
0  10  1  0.0090 -0.05 -0.743740      1   2
1  29  1  0.0060 -0.05 -0.513952      1   2
2  15  1  0.0035 -0.05 -0.283127      1   2
0   1  1  0.0005 -0.05 -0.734266      1   3
1  20  1  0.0065 -0.05 -0.004909      1   3
2  33  1  0.0080 -0.05  1.460910      1   3
3   1  1  0.0005 -0.05  1.698163      1   3
</pre></div>
</div>
</div>
</div>
<div class="section" id="summary-statistics-from-samples">
<h2>Summary statistics from samples<a class="headerlink" href="#summary-statistics-from-samples" title="Permalink to this headline">¶</a></h2>
<p>The sub-module fwdpy.libseq (which we have imported as &#8216;libseq&#8217;) has a
function, &#8216;summstats&#8217;, which calculates many commonly-used summaries of
variation data.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">##This is an example of where you can do a lot in a 1-liner.</span>
<span class="c">##We use nested list comprehensions to:</span>
<span class="c">##  1. Get summary statistics for each element in samples.  We do neutral mutations (element 0)</span>
<span class="c">##     and selected mutations (element 1) separately.</span>
<span class="c">##  2. Turn each dict from libseq.summstats into a pandas.DataFrame</span>
<span class="c">##  3. Combine all those DataFrame objects into one large DataFrame</span>
<span class="n">NeutralMutStats</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;stat&#39;</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">])</span>
                               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">libseq</span><span class="o">.</span><span class="n">summstats</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]])</span>
<span class="n">SelectedMutStats</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;stat&#39;</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">])</span>
                               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">libseq</span><span class="o">.</span><span class="n">summstats</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]])</span>
<span class="k">print</span><span class="p">(</span><span class="n">NeutralMutStats</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">SelectedMutStats</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>          stat      value
0      thetapi  20.447368
1  dsingletons  14.000000
2            S  65.000000
3         tajd   0.471357
4   singletons  14.000000
5       thetah  11.447368
6       hprime   0.877725
7       thetaw  18.321525
0      thetapi  11.342105
1  dsingletons  13.000000
2            S  49.000000
3         tajd  -0.718929
4   singletons  13.000000
5       thetah  12.763158
6       hprime  -0.181022
7       thetaw  13.811611
0      thetapi  15.378947
1  dsingletons  14.000000
2            S  59.000000
3         tajd  -0.304694
4   singletons  14.000000
5       thetah  15.778947
6       hprime  -0.042769
7       thetaw  16.630307
0      thetapi  11.868421
1  dsingletons  15.000000
2            S  49.000000
3         tajd  -0.565706
4   singletons  15.000000
5       thetah   6.973684
6       hprime   0.623519
7       thetaw  13.811611
          stat     value
0      thetapi  0.300000
1  dsingletons  3.000000
2            S  3.000000
3         tajd -1.723310
4   singletons  3.000000
5       thetah  0.015789
6       hprime  0.347472
7       thetaw  0.845609
0      thetapi  0.200000
1  dsingletons  2.000000
2            S  2.000000
3         tajd -1.512836
4   singletons  2.000000
5       thetah  0.010526
6       hprime  0.299199
7       thetaw  0.563739
0      thetapi  0.300000
1  dsingletons  3.000000
2            S  3.000000
3         tajd -1.723310
4   singletons  3.000000
5       thetah  0.015789
6       hprime  0.347472
7       thetaw  0.845609
0      thetapi  0.400000
1  dsingletons  4.000000
2            S  4.000000
3         tajd -1.867878
4   singletons  4.000000
5       thetah  0.021053
6       hprime  0.382404
7       thetaw  1.127478
</pre></div>
</div>
<div class="section" id="the-average-under-the-model">
<h3>The average <span class="math">\(\pi\)</span> under the model<a class="headerlink" href="#the-average-under-the-model" title="Permalink to this headline">¶</a></h3>
<p>Under the BGS model, the expectation of <span class="math">\(\pi\)</span> is
<span class="math">\(E[\pi]=\pi_0e^{-\frac{U}{2sh+r}},\)</span> <span class="math">\(U\)</span> is the mutation rate
to strongly-deleterious variants, <span class="math">\(\pi_0\)</span> is the value expected in
the absence of BGS (<em>i.e.</em> <span class="math">\(\pi_0 = \theta = 4N_e\mu\)</span>), <span class="math">\(s\)</span>
and <span class="math">\(h\)</span> are the selection and dominance coefficients, and
<span class="math">\(r\)</span> is the recombination rate.</p>
<p>Note that the definition of <span class="math">\(U\)</span> is <em>per diploid</em>, meaning twice
the per gamete rate. (See Hudson and Kaplan (1995) PMC1206891 for
details).</p>
<p>For our parameters, we have
<span class="math">\(E[\pi] = 20e^{-\frac{0.02}{0.1+0.005}},\)</span> which equals:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.02</span><span class="o">/</span><span class="p">(</span><span class="mf">0.1</span><span class="o">+</span><span class="mf">0.005</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">16.5313087525</span>
</pre></div>
</div>
<p>Now, let&#8217;s get the average <span class="math">\(\pi\)</span> from 500 simulated replicates. We
already have four replicates that we did above, so we&#8217;ll run another 124
sets of four populations.</p>
<p>We will use standard Python to grow &#8220;pn&#8221;, which is our list of
<span class="math">\(\pi\)</span> values calculated from neutral mutations from each
replicate.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">pops</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">evolve_regions</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span>
                         <span class="mi">4</span><span class="p">,</span>
                         <span class="n">N</span><span class="p">,</span>
                         <span class="n">nlist</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span>
                         <span class="mf">0.005</span><span class="p">,</span>
                         <span class="mf">0.01</span><span class="p">,</span>
                         <span class="mf">0.005</span><span class="p">,</span>
                         <span class="n">nregions</span><span class="p">,</span>
                         <span class="n">sregions</span><span class="p">,</span>
                         <span class="n">recregions</span><span class="p">)</span>
    <span class="c">##This is another heavy one-liner.</span>
    <span class="c">##We&#39;re taking samples of n=20 from each pop,</span>
    <span class="c">##Getting summstats for each neutral block from each sample,</span>
    <span class="c">##Turning the dict into pandas DataFrame objects,</span>
    <span class="c">##and returning a big DataFrame for all the data.</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;stat&#39;</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">libseq</span><span class="o">.</span><span class="n">summstats</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pops</span><span class="p">]]])</span>
    <span class="n">NeutralMutStats</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">NeutralMutStats</span><span class="p">,</span><span class="n">temp</span><span class="p">])</span>
</pre></div>
</div>
<div class="section" id="getting-the-mean-diversity">
<h4>Getting the mean diversity<a class="headerlink" href="#getting-the-mean-diversity" title="Permalink to this headline">¶</a></h4>
<p>We&#8217;ve collected everything into a big pandas DataFrame. We can easily
get the mean using the built-in groupby and mean functions.</p>
<p>For users happier in R, you could write this DataFrame to a text file
and process it using R&#8217;s
<a class="reference external" href="http://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a>
package, which is a really excellent tool for this sort of thing.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">NeutralMutStats</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">&#39;stat&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
    </tr>
    <tr>
      <th>stat</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>S</th>
      <td>58.878000</td>
    </tr>
    <tr>
      <th>dsingletons</th>
      <td>17.016000</td>
    </tr>
    <tr>
      <th>hprime</th>
      <td>0.025761</td>
    </tr>
    <tr>
      <th>singletons</th>
      <td>17.902000</td>
    </tr>
    <tr>
      <th>tajd</th>
      <td>-0.099714</td>
    </tr>
    <tr>
      <th>thetah</th>
      <td>16.366926</td>
    </tr>
    <tr>
      <th>thetapi</th>
      <td>16.358968</td>
    </tr>
    <tr>
      <th>thetaw</th>
      <td>16.595919</td>
    </tr>
  </tbody>
</table>
</div><p>The &#8216;thetapi&#8217; record is our mean <span class="math">\(\pi\)</span> from all of the
simulations, and it is quite close to the theoretical value.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Example: background selection</a><ul>
<li><a class="reference internal" href="#setting-up-the-simulation">Setting up the simulation</a><ul>
<li><a class="reference internal" href="#establishing-regions-for-mutation-and-recombination">Establishing &#8216;regions&#8217; for mutation and recombination</a></li>
<li><a class="reference internal" href="#population-size-and-simulation-length">Population size and simulation length</a></li>
</ul>
</li>
<li><a class="reference internal" href="#taking-samples-from-simulated-populations">Taking samples from simulated populations</a><ul>
<li><a class="reference internal" href="#getting-additional-information-about-samples">Getting additional information about samples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary-statistics-from-samples">Summary statistics from samples</a><ul>
<li><a class="reference internal" href="#the-average-under-the-model">The average <span class="math">\(\pi\)</span> under the model</a><ul>
<li><a class="reference internal" href="#getting-the-mean-diversity">Getting the mean diversity</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="regions.html"
                        title="previous chapter">Example: Modeling regional variation in mutation and recombination</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="windows.html"
                        title="next chapter">Example: Sliding windows</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/docs/BGS.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="windows.html" title="Example: Sliding windows"
             >next</a> |</li>
        <li class="right" >
          <a href="regions.html" title="Example: Modeling regional variation in mutation and recombination"
             >previous</a> |</li>
        <li><a href="../index.html">fwdpy 0.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Kevin Thornton.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>